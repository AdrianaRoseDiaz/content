This is a wrapper to allow or block hash list from XDR, MSDE or CrowdStrike

## Script Data
---

| **Name** | **Description** |
| --- | --- |
| Script Type | python3 |
| Tags | basescript |
| Cortex XSOAR Version | 6.0.0 |

## Inputs
---

| **Argument Name** | **Description** |
| --- | --- |
| hash | Array of sha256 hashes |
| action | The action to do with hash - allow or block |

## Outputs
---

| **Path** | **Description** | **Type** |
| --- | --- | --- |
| MicrosoftATP.Indicators.id | Created by the system when the indicator is ingested. Generated GUID/unique identifier. | String |
| MicrosoftATP.Indicators.action | The action to apply if the indicator is matched from within the targetProduct security tool. Possible values: "unknown", "allow", "block", and "alert". | String |
| MicrosoftATP.Indicators.additionalInformation | A catchall area into which extra data from the indicator not covered by the other indicator properties may be placed. Data placed into additionalInformation is typically not utilized by the targetProduct security tool. | String |
| MicrosoftATP.Indicators.azureTenantId | Stamped by the system when the indicator is ingested. The Azure Active Directory tenant id of submitting client. | String |
| MicrosoftATP.Indicators.confidence | An integer representing the confidence with which the data within the indicator accurately identifies malicious behavior. Possible values are 0 – 100, with 100 being the highest. | Number |
| MicrosoftATP.Indicators.description | Brief description \(100 characters or less\) of the threat represented by the indicator. | String |
| MicrosoftATP.Indicators.diamondModel | The area of the Diamond Model in which this indicator exists. Possible values: "unknown", "adversary", "capability", "infrastructure", and "victim". | String |
| MicrosoftATP.Indicators.domainName | Domain name associated with this indicator. Should be in the format subdomain.domain.topleveldomain. | String |
| MicrosoftATP.Indicators.expirationDateTime | DateTime string indicating when the indicator expires. To avoid stale indicators persisting in the system, all indicators must have an expiration date. The timestamp type represents date and time information in ISO 8601 format and is always in UTC time. For example, midnight UTC on Jan 1, 2014 looks like: '2014-01-01T00:00:00Z' | Date |
| MicrosoftATP.Indicators.externalId | An identification number that ties the indicator back to the indicator provider’s system \(e.g., a foreign key\). | String |
| MicrosoftATP.Indicators.fileCompileDateTime | DateTime when the file was compiled. The timestamp type represents date and time information in ISO 8601 format and is always in UTC time. For example, midnight UTC on Jan 1, 2014 looks like: '2014-01-01T00:00:00Z' | Date |
| MicrosoftATP.Indicators.fileCreatedDateTime | DateTime when the file was created.The Timestamp type represents date and time information in ISO 8601 format and is always in UTC time. For example, midnight UTC on Jan 1, 2014 looks like: '2014-01-01T00:00:00Z' | Date |
| MicrosoftATP.Indicators.fileHashType | The type of hash stored in fileHashValue. Possible values: "unknown", "sha1", "sha256", "md5", "authenticodeHash256", "lsHash", and "ctph". | String |
| MicrosoftATP.Indicators.fileHashValue | The file hash value. | String |
| MicrosoftATP.Indicators.fileMutexName | Mutex name used in file-based detections. | String |
| MicrosoftATP.Indicators.fileName | Name of the file if the indicator is file-based. Multiple file names may be delimited by commas. | String |
| MicrosoftATP.Indicators.filePacker | The packer used to build the file in question. | String |
| MicrosoftATP.Indicators.filePath | Path of the file indicating a compromise. Can be a Windows or \*nix style path. | String |
| MicrosoftATP.Indicators.fileSize | Size of the file in bytes. | Number |
| MicrosoftATP.Indicators.fileType | Text description of the type of file. For example, “Word Document” or “Binary”. | String |
| MicrosoftATP.Indicators.ingestedDateTime | Timestamp when the indicator was ingested into the system. The Timestamp type represents date and time information in ISO 8601 format and is always in UTC time. For example, midnight UTC on Jan 1, 2014 looks like: '2014-01-01T00:00:00Z' | Date |
| MicrosoftATP.Indicators.isActive | Used to deactivate indicators within the system. By default, any indicator submitted is set as active. However, providers may submit existing indicators with this set to ‘False’ to deactivate indicators in the system. | Boolean |
| MicrosoftATP.Indicators.knownFalsePositives | Scenarios in which the indicator may cause false positives. This should be human-readable text. | String |
| MicrosoftATP.Indicators.lastReportedDateTime | The last time the indicator was seen. The timestamp type represents date and time information in ISO 8601 format and is always in UTC time. For example, midnight UTC on Jan 1, 2014 looks like: '2014-01-01T00:00:00Z' | Date |
| MicrosoftATP.Indicators.networkCidrBlock | CIDR Block notation representation of the network referenced in this indicator. Use only if the Source and Destination cannot be identified. | String |
| MicrosoftATP.Indicators.networkDestinationAsn | The destination autonomous system identifier of the network referenced in the indicator. | Number |
| MicrosoftATP.Indicators.networkDestinationCidrBlock | CIDR Block notation representation of the destination network in this indicator. | String |
| MicrosoftATP.Indicators.networkDestinationIPv4 | IPv4 IP address destination. | String |
| MicrosoftATP.Indicators.networkDestinationIPv6 | IPv6 IP address destination. | String |
| MicrosoftATP.Indicators.networkDestinationPort | TCP port destination. | Number |
| MicrosoftATP.Indicators.networkIPv4 | IPv4 IP address. | String |
| MicrosoftATP.Indicators.networkIPv6 | IPv6 IP address. | String |
| MicrosoftATP.Indicators.networkPort | TCP port. | Number |
| MicrosoftATP.Indicators.networkProtocol | Decimal representation of the protocol field in the IPv4 header. | Number |
| MicrosoftATP.Indicators.networkSourceAsn | The source autonomous system identifier of the network referenced in the indicator. | Number |
| MicrosoftATP.Indicators.networkSourceCidrBlock | CIDR Block notation representation of the source network in this indicator. | String |
| MicrosoftATP.Indicators.networkSourceIPv4 | IPv4 IP address source. | String |
| MicrosoftATP.Indicators.networkSourceIPv6 | IPv6 IP address source. | String |
| MicrosoftATP.Indicators.networkSourcePort | TCP port source. | Number |
| MicrosoftATP.Indicators.passiveOnly | Determines if the indicator should trigger an event that is visible to an end-user. When set to ‘true,’ security tools do not notify the end user that a ‘hit’ has occurred. This is most often treated as audit or silent mode by security products where they simply log that a match occurred but do not perform the action. Default value is false. | Boolean |
| MicrosoftATP.Indicators.severity | An integer representing the severity of the malicious behavior identified by the data within the indicator. Possible values: "Informational", "Low", "MediumLow", "MediumHigh", and "High", where High is the most severe and Informational is not severe at all. | Number |
| MicrosoftATP.Indicators.targetProduct | A string value representing a single security product to which the indicator should be applied. | String |
| MicrosoftATP.Indicators.threatType | Each indicator must have a valid Indicator Threat Type. Possible values: "Botnet", "C2", "CryptoMining", "Darknet", "DDoS", "MaliciousUrl", "Malware", "Phishing", "Proxy", "PUA", and "WatchList". | String |
| MicrosoftATP.Indicators.tlpLevel | Traffic Light Protocol value for the indicator. Possible values: "unknown", "white", "green", "amber", and "red". | String |
| MicrosoftATP.Indicators.url | Uniform Resource Locator. This URL complies with RFC 1738. | String |
| MicrosoftATP.Indicators.userAgent | User-Agent string from a web request that could indicate compromise. | String |
| MicrosoftATP.Indicators.vendorInformation | Information about the vendor. | String |
| File.Name | The full file name \(including file extension\). | String |
| File.Size | The size of the file in bytes. | Number |
| File.MD5 | The MD5 hash of the file. | String |
| File.SHA1 | The SHA1 hash of the file. | String |
| File.SHA256 | The SHA1 hash of the file. | String |
| File.SHA512 | The SHA512 hash of the file. | String |
| File.Type | The file type, as determined by libmagic \(same as displayed in file entries\). | String |
| File.Path | The path where the file is located. | String |
| CrowdStrike.IOC.Type | The type of the IOC. | string |
| CrowdStrike.IOC.Value | The string representation of the indicator. | string |
| CrowdStrike.IOC.ID | The full ID of the indicator \(type:value\). | string |
| CrowdStrike.IOC.Policy | The policy of the indicator. | string |
| CrowdStrike.IOC.Source | The source of the IOC. | string |
| CrowdStrike.IOC.ShareLevel | The level at which the indicator will be shared. | string |
| CrowdStrike.IOC.Expiration | The datetime when the indicator will expire. | string |
| CrowdStrike.IOC.Description | The description of the IOC. | string |
| CrowdStrike.IOC.CreatedTime | The datetime the IOC was created. | string |
| CrowdStrike.IOC.CreatedBy | The identity of the user/process who created the IOC. | string |
| CrowdStrike.IOC.ModifiedTime | The date and time the indicator was last modified. | string |
| CrowdStrike.IOC.ModifiedBy | The identity of the user/process who last updated the IOC. | string |


## Script Examples
### Example command
```!CreateHashIndicatorWrapper action=block hash=006a103a9f4b9b6273d55b16ba01a704ad3e4fad59f198a77e8b64177a1064ef,73c8c51f9084ec745ddb86c9f1a8da3281b6cf5276300e3df0e32ae44b76f63f```
### Context Example
```json
{
    "CrowdStrike": {
        "IOC": [
            {
                "Action": "prevent",
                "CreatedBy": "2bf188d347e44e08946f2e61ef590c24",
                "CreatedTime": "2022-03-09T09:58:03.608685951Z",
                "Description": "Blacklisted based on XSOAR inc ab57e22c-ad03-4aba-8b6c-b42bd895a116",
                "ID": "5e6bf43f5de8b64e3d6f37177171d7edceed67d6bcac06a953c3d369151f6f39",
                "ModifiedBy": "2bf188d347e44e08946f2e61ef590c24",
                "ModifiedTime": "2022-03-09T09:58:03.608685951Z",
                "Platforms": [
                    "linux",
                    "mac",
                    "windows"
                ],
                "Severity": "high",
                "Type": "sha256",
                "Value": "006a103a9f4b9b6273d55b16ba01a704ad3e4fad59f198a77e8b64177a1064ef"
            },
            {
                "Action": "prevent",
                "CreatedBy": "2bf188d347e44e08946f2e61ef590c24",
                "CreatedTime": "2022-03-09T09:58:04.151795968Z",
                "Description": "Blacklisted based on XSOAR inc ab57e22c-ad03-4aba-8b6c-b42bd895a116",
                "ID": "aa6ab986d7a9bf41d96e0140f373e2806d2d2b8a389eeff160d02d88b4229586",
                "ModifiedBy": "2bf188d347e44e08946f2e61ef590c24",
                "ModifiedTime": "2022-03-09T09:58:04.151795968Z",
                "Platforms": [
                    "linux",
                    "mac",
                    "windows"
                ],
                "Severity": "high",
                "Type": "sha256",
                "Value": "73c8c51f9084ec745ddb86c9f1a8da3281b6cf5276300e3df0e32ae44b76f63f"
            }
        ]
    },
    "DBotScore": [
        {
            "Indicator": "006a103a9f4b9b6273d55b16ba01a704ad3e4fad59f198a77e8b64177a1064ef",
            "Score": 0,
            "Type": "file",
            "Vendor": "Microsoft Defender Advanced Threat Protection"
        },
        {
            "Indicator": "73c8c51f9084ec745ddb86c9f1a8da3281b6cf5276300e3df0e32ae44b76f63f",
            "Score": 0,
            "Type": "file",
            "Vendor": "Microsoft Defender Advanced Threat Protection"
        }
    ],
    "File": [
        {
            "SHA256": "006a103a9f4b9b6273d55b16ba01a704ad3e4fad59f198a77e8b64177a1064ef"
        },
        {
            "SHA256": "73c8c51f9084ec745ddb86c9f1a8da3281b6cf5276300e3df0e32ae44b76f63f"
        }
    ],
    "MicrosoftATP": {
        "Indicators": [
            {
                "@odata.context": "https://api.securitycenter.microsoft.com/api/$metadata#Indicators/$entity",
                "action": "BlockAndRemediate",
                "createdBy": "2f48b784-5da5-4e61-9957-012d2630f1e4",
                "createdByDisplayName": "MS Graph ATP DEV",
                "createdBySource": "PublicApi",
                "creationTimeDateTimeUtc": "2022-03-09T09:58:02.9610691Z",
                "description": "XSOAR - related incident ab57e22c-ad03-4aba-8b6c-b42bd895a116",
                "expirationTime": "2022-03-23T09:58:01Z",
                "generateAlert": true,
                "historicalDetection": false,
                "id": "5290",
                "indicatorType": "FileSha256",
                "indicatorValue": "006a103a9f4b9b6273d55b16ba01a704ad3e4fad59f198a77e8b64177a1064ef",
                "lastUpdateTime": "2022-03-09T09:58:02.9733307Z",
                "mitreTechniques": [],
                "rbacGroupIds": [],
                "rbacGroupNames": [],
                "severity": "Informational",
                "title": "XSOAR - related incident ab57e22c-ad03-4aba-8b6c-b42bd895a116"
            },
            {
                "@odata.context": "https://api.securitycenter.microsoft.com/api/$metadata#Indicators/$entity",
                "action": "BlockAndRemediate",
                "createdBy": "2f48b784-5da5-4e61-9957-012d2630f1e4",
                "createdByDisplayName": "MS Graph ATP DEV",
                "createdBySource": "PublicApi",
                "creationTimeDateTimeUtc": "2022-03-09T09:58:03.2617492Z",
                "description": "XSOAR - related incident ab57e22c-ad03-4aba-8b6c-b42bd895a116",
                "expirationTime": "2022-03-23T09:58:03Z",
                "generateAlert": true,
                "historicalDetection": false,
                "id": "5291",
                "indicatorType": "FileSha256",
                "indicatorValue": "73c8c51f9084ec745ddb86c9f1a8da3281b6cf5276300e3df0e32ae44b76f63f",
                "lastUpdateTime": "2022-03-09T09:58:03.2773878Z",
                "mitreTechniques": [],
                "rbacGroupIds": [],
                "rbacGroupNames": [],
                "severity": "Informational",
                "title": "XSOAR - related incident ab57e22c-ad03-4aba-8b6c-b42bd895a116"
            }
        ]
    },
    "PaloAltoNetworksXDR": {
        "blackList": {
            "fileHash": [
                "006a103a9f4b9b6273d55b16ba01a704ad3e4fad59f198a77e8b64177a1064ef",
                "73c8c51f9084ec745ddb86c9f1a8da3281b6cf5276300e3df0e32ae44b76f63f"
            ]
        }
    }
}
```

### Human Readable Output

>### Custom IOC 73c8c51f9084ec745ddb86c9f1a8da3281b6cf5276300e3df0e32ae44b76f63f was created successfully
>|Action|CreatedBy|CreatedTime|Description|ID|ModifiedBy|ModifiedTime|Platforms|Severity|Type|Value|
>|---|---|---|---|---|---|---|---|---|---|---|
>| prevent | 2bf188d347e44e08946f2e61ef590c24 | 2022-03-09T09:58:04.151795968Z | Blacklisted based on XSOAR inc ab57e22c-ad03-4aba-8b6c-b42bd895a116 | aa6ab986d7a9bf41d96e0140f373e2806d2d2b8a389eeff160d02d88b4229586 | 2bf188d347e44e08946f2e61ef590c24 | 2022-03-09T09:58:04.151795968Z | linux,<br/>mac,<br/>windows | high | sha256 | 73c8c51f9084ec745ddb86c9f1a8da3281b6cf5276300e3df0e32ae44b76f63f |

